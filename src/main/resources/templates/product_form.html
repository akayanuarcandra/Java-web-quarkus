{#include base/main.html}
{#title}{isNew ? 'Add' : 'Edit'} Product{/title}
{#body}
<div class="bg-white p-8 rounded shadow-md w-full max-w-lg mx-auto">
    <h2 class="text-2xl font-bold mb-6 text-center">{isNew ? 'Add' : 'Edit'} Product</h2>
    <form action="/dashboard/save" method="post" enctype="multipart/form-data">
        <input type="hidden" name="id" value="{product.id}">
        <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="name">Name:</label>
            <input type="text"
                class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="name"
                name="name" value="{product.name}" required>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="description">Description:</label>
            <textarea class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                id="description" name="description" required>{product.description}</textarea>
        </div>
        <div class="mb-4">
            <label class="block text-gray-700 mb-2" for="price">Price:</label>
            <input type="number" step="0.01"
                class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="price"
                name="price" value="{product.price}" required>
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 mb-2" for="quantity">Quantity:</label>
            <input type="number"
                class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                id="quantity" name="quantity" value="{product.quantity}" required>
        </div>
        <div class="mb-6">
            <label class="block text-gray-700 mb-2" for="image">Image:</label>
            <div class="relative">
                <input type="file" id="image" name="image" accept="image/*" class="hidden">
                <div id="imageDrop" role="button" tabindex="0"
                    class="w-full h-48 border border-dashed rounded-md flex items-center justify-center cursor-pointer bg-gray-50 hover:bg-gray-100">
                    {#if product.imagePath}
                    <img id="preview" src="/uploads/{product.imagePath.replace(' ', '%20')}" alt="Product Image"
                        class="absolute inset-0 w-full h-full object-cover rounded-md">
                    {#else}
                    <div id="placeholder" class="flex flex-col items-center text-gray-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span class="mt-2">Add an image</span>
                    </div>
                    <img id="preview" style="display:none" alt="Product Image Preview"
                        class="absolute inset-0 w-full h-full object-cover rounded-md">
                    {/if}
                </div>
            </div>
            <script>
                (function () {
                    const fileInput = document.getElementById('image');
                    const drop = document.getElementById('imageDrop');
                    const placeholder = document.getElementById('placeholder');
                    const preview = document.getElementById('preview');

                    if (!drop || !fileInput) return;

                    drop.addEventListener('click', () => fileInput.click());
                    drop.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });

                    fileInput.addEventListener('change', (e) => {
                        const file = e.target.files && e.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = function (ev) {
                            if (preview) {
                                preview.src = ev.target.result;
                                preview.style.display = 'block';
                            }
                            if (placeholder) {
                                placeholder.style.display = 'none';
                            }
                        };
                        reader.readAsDataURL(file);
                    });
                })();
            </script>
        </div>
        <button type="submit"
            class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Save</button>
    </form>
</div>
{/body}